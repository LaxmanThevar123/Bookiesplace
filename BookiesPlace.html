<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookiesPlace - Online Book Catalogue</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); font-size: 18px; min-height: 100vh; }
        .header { background: rgba(0,0,0,0.3); backdrop-filter: blur(10px); color: white; padding: 30px; text-align: center; box-shadow: 0 8px 32px rgba(0,0,0,0.1); }
        .header h1 { font-size: 36px; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .contact { font-size: 20px; margin-top: 10px; }
        .admin-btn { position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border: none; padding: 12px 20px; border-radius: 25px; cursor: pointer; font-size: 16px; z-index: 100; box-shadow: 0 5px 20px rgba(0,0,0,0.3); transition: transform 0.2s; }
        .admin-btn:hover { transform: scale(1.05); }
        .search-bar { padding: 20px; background: rgba(255,255,255,0.95); margin: 20px; border-radius: 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.2); backdrop-filter: blur(10px); }
        .search-bar input { width: 100%; padding: 15px; font-size: 18px; border: none; border-radius: 10px; background: white; box-shadow: inset 0 2px 8px rgba(0,0,0,0.1); }
        .filters { padding: 20px; margin: 0 20px 20px 20px; background: rgba(255,255,255,0.95); border-radius: 15px; display: flex; gap: 10px; flex-wrap: wrap; box-shadow: 0 8px 32px rgba(0,0,0,0.2); }
        .filter-btn { padding: 12px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 16px; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .filter-btn.active { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
        .filter-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
        .books-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; padding: 20px; }
        .book-card { background: rgba(255,255,255,0.95); border-radius: 20px; padding: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); transition: transform 0.3s, box-shadow 0.3s; backdrop-filter: blur(10px); }
        .book-card:hover { transform: translateY(-10px) rotateX(5deg); box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .book-cover { width: 100%; height: 250px; object-fit: cover; border-radius: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .book-title { font-size: 20px; font-weight: bold; margin: 10px 0; color: #2c3e50; }
        .book-author { color: #7f8c8d; font-size: 16px; margin-bottom: 8px; }
        .book-category { display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 5px 15px; border-radius: 20px; font-size: 14px; margin-bottom: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .book-summary { color: #555; font-size: 15px; line-height: 1.5; margin-top: 8px; }
        .book-price { font-size: 22px; font-weight: bold; color: #27ae60; margin-top: 10px; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; overflow-y: auto; }
        .modal-content { background: white; margin: 50px auto; padding: 30px; max-width: 600px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
        .modal-content h2 { margin-bottom: 20px; font-size: 26px; }
        .modal-content input, .modal-content textarea, .modal-content select { width: 100%; padding: 12px; margin: 10px 0; font-size: 16px; border: 2px solid #ddd; border-radius: 10px; transition: border 0.3s; }
        .modal-content input:focus, .modal-content textarea:focus, .modal-content select:focus { outline: none; border: 2px solid #667eea; }
        .modal-content button { padding: 12px 25px; margin: 10px 5px; font-size: 16px; border: none; border-radius: 25px; cursor: pointer; transition: transform 0.2s; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .modal-content button:hover { transform: translateY(-2px); }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-secondary { background: #95a5a6; color: white; }
        .btn-danger { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }
        .admin-panel { padding: 20px; }
        .admin-actions { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .book-list-item { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .book-list-item:hover { transform: translateX(5px); }
        .no-books { text-align: center; padding: 50px; font-size: 20px; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .admin-search { padding: 15px; margin: 10px 0; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; width: 100%; }
        .cover-preview { max-width: 200px; max-height: 300px; margin: 15px auto; border-radius: 10px; display: block; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .loading-spinner { display: none; margin: 10px 0; color: #667eea; font-weight: bold; }
        .auto-filled { background: #d4edda !important; border-color: #28a745 !important; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìö BookiesPlace</h1>
        <p>Your Online Book Store</p>
        <div class="contact">üìû Contact: +1-234-567-8900</div>
    </div>

    <button class="admin-btn" onclick="showAdminLogin()">Admin</button>

    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="üîç Search by book name or author..." oninput="filterBooks()">
    </div>

    <div class="filters">
        <button class="filter-btn active" onclick="filterByCategory('All')">All</button>
        <button class="filter-btn" onclick="filterByCategory('Fiction')">Fiction</button>
        <button class="filter-btn" onclick="filterByCategory('History')">History</button>
        <button class="filter-btn" onclick="filterByCategory('Mystery')">Mystery</button>
        <button class="filter-btn" onclick="filterByCategory('Fantasy')">Fantasy</button>
        <button class="filter-btn" onclick="filterByCategory('Romance')">Romance</button>
        <button class="filter-btn" onclick="filterByCategory('Science')">Science</button>
        <button class="filter-btn" onclick="filterByCategory('Biography')">Biography</button>
    </div>

    <div class="books-grid" id="booksGrid"></div>

    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="modal">
        <div class="modal-content">
            <h2>Admin Login</h2>
            <input type="password" id="adminPassword" placeholder="Enter password">
            <button class="btn-primary" onclick="adminLogin()">Login</button>
            <button class="btn-secondary" onclick="closeModal('adminLoginModal')">Cancel</button>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="adminPanelModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <h2>Admin Panel</h2>
            <div class="admin-actions">
                <button class="btn-primary" onclick="showAddBookForm()">Add New Book</button>
                <button class="btn-primary" onclick="exportBackup()">üì• Export Backup</button>
                <button class="btn-primary" onclick="document.getElementById('importFile').click()">üì§ Import Backup</button>
                <input type="file" id="importFile" style="display:none" accept=".json" onchange="importBackup(event)">
                <button class="btn-secondary" onclick="closeModal('adminPanelModal')">Close</button>
            </div>
            <input type="text" id="adminSearchInput" class="admin-search" placeholder="üîç Search books in admin panel..." oninput="displayAdminBooks()">
            <div id="adminBooksList"></div>
        </div>
    </div>

    <!-- Add/Edit Book Modal -->
    <div id="bookFormModal" class="modal">
        <div class="modal-content">
            <h2 id="formTitle">Add New Book</h2>
            
            <div style="margin-bottom: 20px;">
                <input type="text" id="bookSearchInput" placeholder="üîç Search book by name..." style="width: 100%; padding: 12px; font-size: 16px; border: 2px solid #667eea; border-radius: 10px;">
                <button class="btn-primary" onclick="searchOpenLibrary()" style="width: 100%; margin-top: 10px;">Search Open Library</button>
            </div>
            <div id="searchResults" style="max-height: 200px; overflow-y: auto; margin-bottom: 15px;"></div>
            <div id="loadingSpinner" class="loading-spinner">üîç Searching Open Library...</div>
            
            <img id="coverPreview" class="cover-preview" style="display:none">
            
            <input type="text" id="bookTitle" placeholder="Book Title" readonly>
            <input type="text" id="bookAuthor" placeholder="Author Name" readonly>
            <select id="bookCategory">
                <option value="Fiction">Fiction</option>
                <option value="History">History</option>
                <option value="Mystery">Mystery</option>
                <option value="Fantasy">Fantasy</option>
                <option value="Romance">Romance</option>
                <option value="Science">Science</option>
                <option value="Biography">Biography</option>
            </select>
            <textarea id="bookSummary" placeholder="Book Summary" rows="4" readonly></textarea>
            <input type="number" id="bookPrice" placeholder="Price (e.g., 15.99)" step="0.01">
            <input type="text" id="bookISBN" placeholder="ISBN (optional - for cover image)" style="display:none">
            <button class="btn-primary" onclick="saveBook()">Save Book</button>
            <button class="btn-secondary" onclick="closeModal('bookFormModal')">Cancel</button>
        </div>
    </div>

    <script>
        const ADMIN_PASSWORD = "bookies2024";
        let books = [];
        let currentFilter = 'All';
        let editingBookId = null;
        let uploadedCoverUrl = null;

        // Initialize
        function init() {
            loadBooks();
            if (books.length === 0) {
                loadDefaultBooks();
            }
            displayBooks();
            setupAutoBackup();
        }

        // Load books from localStorage
        function loadBooks() {
            const stored = localStorage.getItem('bookiesplace_books');
            if (stored) {
                books = JSON.parse(stored);
            }
        }

        // Save books to localStorage
        function saveBooks() {
            localStorage.setItem('bookiesplace_books', JSON.stringify(books));
        }

        // Load default 2500+ books
        function loadDefaultBooks() {
            const categories = ['Fiction', 'History', 'Mystery', 'Fantasy', 'Romance', 'Science', 'Biography'];
            
            const bookData = {
                Fiction: [
                    {title: 'To Kill a Mockingbird', author: 'Harper Lee', isbn: '9780061120084'},
                    {title: 'The Great Gatsby', author: 'F. Scott Fitzgerald', isbn: '9780743273565'},
                    {title: 'Pride and Prejudice', author: 'Jane Austen', isbn: '9780141439518'},
                    {title: '1984', author: 'George Orwell', isbn: '9780451524935'},
                    {title: 'The Catcher in the Rye', author: 'J.D. Salinger', isbn: '9780316769174'}
                ],
                History: [
                    {title: 'Sapiens', author: 'Yuval Noah Harari', isbn: '9780062316097'},
                    {title: 'The Guns of August', author: 'Barbara W. Tuchman', isbn: '9780345476098'},
                    {title: 'A People\'s History', author: 'Howard Zinn', isbn: '9780062397348'},
                    {title: 'The Rise and Fall of the Third Reich', author: 'William L. Shirer', isbn: '9781451651683'},
                    {title: 'Team of Rivals', author: 'Doris Kearns Goodwin', isbn: '9780743270755'}
                ],
                Mystery: [
                    {title: 'The Girl with the Dragon Tattoo', author: 'Stieg Larsson', isbn: '9780307454546'},
                    {title: 'Gone Girl', author: 'Gillian Flynn', isbn: '9780307588371'},
                    {title: 'The Da Vinci Code', author: 'Dan Brown', isbn: '9780307474278'},
                    {title: 'Murder on the Orient Express', author: 'Agatha Christie', isbn: '9780062693662'},
                    {title: 'The Hound of the Baskervilles', author: 'Arthur Conan Doyle', isbn: '9780451528018'}
                ],
                Fantasy: [
                    {title: 'Harry Potter and the Sorcerer\'s Stone', author: 'J.K. Rowling', isbn: '9780590353427'},
                    {title: 'The Hobbit', author: 'J.R.R. Tolkien', isbn: '9780547928227'},
                    {title: 'A Game of Thrones', author: 'George R.R. Martin', isbn: '9780553103540'},
                    {title: 'The Name of the Wind', author: 'Patrick Rothfuss', isbn: '9780756404079'},
                    {title: 'The Way of Kings', author: 'Brandon Sanderson', isbn: '9780765326355'}
                ],
                Romance: [
                    {title: 'The Notebook', author: 'Nicholas Sparks', isbn: '9780446605236'},
                    {title: 'Me Before You', author: 'Jojo Moyes', isbn: '9780143124542'},
                    {title: 'Outlander', author: 'Diana Gabaldon', isbn: '9780440212560'},
                    {title: 'The Time Traveler\'s Wife', author: 'Audrey Niffenegger', isbn: '9780156029438'},
                    {title: 'The Fault in Our Stars', author: 'John Green', isbn: '9780142424179'}
                ],
                Science: [
                    {title: 'A Brief History of Time', author: 'Stephen Hawking', isbn: '9780553380163'},
                    {title: 'The Selfish Gene', author: 'Richard Dawkins', isbn: '9780198788607'},
                    {title: 'Cosmos', author: 'Carl Sagan', isbn: '9780345539434'},
                    {title: 'The Origin of Species', author: 'Charles Darwin', isbn: '9780451529060'},
                    {title: 'Astrophysics for People in a Hurry', author: 'Neil deGrasse Tyson', isbn: '9780393609394'}
                ],
                Biography: [
                    {title: 'Steve Jobs', author: 'Walter Isaacson', isbn: '9781451648539'},
                    {title: 'The Diary of a Young Girl', author: 'Anne Frank', isbn: '9780553296983'},
                    {title: 'Long Walk to Freedom', author: 'Nelson Mandela', isbn: '9780316548182'},
                    {title: 'Becoming', author: 'Michelle Obama', isbn: '9781524763138'},
                    {title: 'Einstein: His Life and Universe', author: 'Walter Isaacson', isbn: '9780743264747'}
                ]
            };
            
            const summaries = {
                Fiction: ['A compelling story of love and loss.', 'An unforgettable journey through time.', 'A tale of redemption and hope.', 'A gripping narrative of human resilience.'],
                History: ['A detailed account of historical events.', 'Exploring the past with vivid detail.', 'Chronicles of a bygone era.', 'Historical insights that shape our present.'],
                Mystery: ['A thrilling whodunit that keeps you guessing.', 'Unravel the mystery page by page.', 'A detective story full of twists.', 'Suspense that grips you till the end.'],
                Fantasy: ['An epic adventure in magical realms.', 'Where magic and reality collide.', 'A fantastical journey beyond imagination.', 'Dragons, wizards, and epic quests.'],
                Romance: ['A heartwarming love story.', 'Passion and romance intertwined.', 'Love conquers all in this tale.', 'A beautiful story of two hearts.'],
                Science: ['Exploring the wonders of science.', 'Scientific discoveries that changed the world.', 'A journey through scientific innovation.', 'Understanding our universe through science.'],
                Biography: ['The inspiring life story of a legend.', 'A remarkable journey of achievement.', 'From humble beginnings to greatness.', 'The life and times of an icon.']
            };

            let bookId = 1;
            for (let i = 0; i < 500; i++) {
                categories.forEach(category => {
                    const categoryBooks = bookData[category];
                    const book = categoryBooks[i % categoryBooks.length];
                    const summaryList = summaries[category];
                    const summary = summaryList[Math.floor(Math.random() * summaryList.length)];
                    const price = (Math.random() * 30 + 5).toFixed(2);

                    books.push({
                        id: Date.now() + bookId++,
                        title: book.title,
                        author: book.author,
                        category: category,
                        summary: summary,
                        price: price,
                        cover: `https://covers.openlibrary.org/b/isbn/${book.isbn}-L.jpg`
                    });
                });
            }
            saveBooks();
        }

        // Display books
        function displayBooks() {
            const grid = document.getElementById('booksGrid');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            let filtered = books.filter(book => {
                const matchesCategory = currentFilter === 'All' || book.category === currentFilter;
                const matchesSearch = book.title.toLowerCase().includes(searchTerm) || 
                                     book.author.toLowerCase().includes(searchTerm);
                return matchesCategory && matchesSearch;
            });

            if (filtered.length === 0) {
                grid.innerHTML = '<div class="no-books">No books found</div>';
                return;
            }

            grid.innerHTML = filtered.map(book => `
                <div class="book-card">
                    <img class="book-cover" src="${book.cover}" alt="${book.title}" onerror="this.src='https://covers.openlibrary.org/b/id/8739161-L.jpg'">
                    <div class="book-title">${book.title}</div>
                    <div class="book-author">by ${book.author}</div>
                    <span class="book-category">${book.category}</span>
                    <div class="book-summary">${book.summary}</div>
                    <div class="book-price">$${book.price}</div>
                </div>
            `).join('');
        }

        // Filter by category
        function filterByCategory(category) {
            currentFilter = category;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            displayBooks();
        }

        // Filter books by search
        function filterBooks() {
            displayBooks();
        }

        // Admin login
        function showAdminLogin() {
            document.getElementById('adminLoginModal').style.display = 'block';
        }

        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                closeModal('adminLoginModal');
                showAdminPanel();
            } else {
                alert('Incorrect password!');
            }
            document.getElementById('adminPassword').value = '';
        }

        // Show admin panel
        function showAdminPanel() {
            document.getElementById('adminPanelModal').style.display = 'block';
            displayAdminBooks();
        }

        // Display books in admin panel
        function displayAdminBooks() {
            const list = document.getElementById('adminBooksList');
            const searchTerm = document.getElementById('adminSearchInput').value.toLowerCase();
            
            const filtered = books.filter(book => 
                book.title.toLowerCase().includes(searchTerm) || 
                book.author.toLowerCase().includes(searchTerm)
            );
            
            list.innerHTML = filtered.map(book => `
                <div class="book-list-item">
                    <div>
                        <strong>${book.title}</strong> by ${book.author} - $${book.price}
                    </div>
                    <div>
                        <button class="btn-primary" onclick="editBook(${book.id})">Edit</button>
                        <button class="btn-danger" onclick="deleteBook(${book.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Search Open Library by book name
        async function searchOpenLibrary() {
            const searchTerm = document.getElementById('bookSearchInput').value.trim();
            if (!searchTerm) {
                alert('Please enter a book name to search');
                return;
            }

            document.getElementById('loadingSpinner').style.display = 'block';
            document.getElementById('searchResults').innerHTML = '';

            try {
                const response = await fetch(`https://openlibrary.org/search.json?q=${encodeURIComponent(searchTerm)}&limit=5`);
                const data = await response.json();

                document.getElementById('loadingSpinner').style.display = 'none';

                if (data.docs && data.docs.length > 0) {
                    const resultsHtml = data.docs.map((book, index) => {
                        const title = book.title || 'Unknown Title';
                        const author = book.author_name ? book.author_name.join(', ') : 'Unknown Author';
                        const coverId = book.cover_i;
                        const subjects = book.subject ? book.subject.slice(0, 3).join(', ') : '';
                        
                        return `
                            <div style="padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 10px; cursor: pointer; border: 2px solid #ddd;" 
                                 onclick="selectBook(${index})" 
                                 onmouseover="this.style.borderColor='#667eea'" 
                                 onmouseout="this.style.borderColor='#ddd'">
                                <strong>${title}</strong><br>
                                <small>by ${author}</small><br>
                                ${subjects ? `<small style="color: #666;">${subjects}</small>` : ''}
                            </div>
                        `;
                    }).join('');
                    
                    document.getElementById('searchResults').innerHTML = resultsHtml;
                    
                    // Store search results for selection
                    window.searchResultsData = data.docs;
                } else {
                    document.getElementById('searchResults').innerHTML = '<p style="color: #999; text-align: center;">No books found. Try a different search term.</p>';
                }
            } catch (error) {
                console.error('Search error:', error);
                document.getElementById('loadingSpinner').style.display = 'none';
                alert('Error searching Open Library. Please try again.');
            }
        }

        // Select a book from search results
        async function selectBook(index) {
            const book = window.searchResultsData[index];
            if (!book) return;

            document.getElementById('loadingSpinner').style.display = 'block';

            try {
                // Get work details for description
                let description = 'A fascinating book worth reading.';
                if (book.key) {
                    try {
                        const workResponse = await fetch(`https://openlibrary.org${book.key}.json`);
                        const workData = await workResponse.json();
                        if (workData.description) {
                            description = typeof workData.description === 'string' 
                                ? workData.description 
                                : workData.description.value || description;
                        }
                    } catch (e) {
                        console.log('Could not fetch description');
                    }
                }

                // Fill form fields
                document.getElementById('bookTitle').value = book.title || '';
                document.getElementById('bookTitle').readOnly = false;
                document.getElementById('bookTitle').classList.add('auto-filled');
                
                document.getElementById('bookAuthor').value = book.author_name ? book.author_name.join(', ') : '';
                document.getElementById('bookAuthor').readOnly = false;
                
                document.getElementById('bookSummary').value = description;
                document.getElementById('bookSummary').readOnly = false;

                // Auto-detect category from subjects
                if (book.subject && book.subject.length > 0) {
                    const subjects = book.subject.join(' ').toLowerCase();
                    if (subjects.includes('fiction') || subjects.includes('novel')) {
                        document.getElementById('bookCategory').value = 'Fiction';
                    } else if (subjects.includes('history')) {
                        document.getElementById('bookCategory').value = 'History';
                    } else if (subjects.includes('mystery') || subjects.includes('thriller') || subjects.includes('detective')) {
                        document.getElementById('bookCategory').value = 'Mystery';
                    } else if (subjects.includes('fantasy') || subjects.includes('magic')) {
                        document.getElementById('bookCategory').value = 'Fantasy';
                    } else if (subjects.includes('romance') || subjects.includes('love')) {
                        document.getElementById('bookCategory').value = 'Romance';
                    } else if (subjects.includes('science')) {
                        document.getElementById('bookCategory').value = 'Science';
                    } else if (subjects.includes('biography') || subjects.includes('autobiography')) {
                        document.getElementById('bookCategory').value = 'Biography';
                    }
                }

                // Set cover image
                if (book.cover_i) {
                    uploadedCoverUrl = `https://covers.openlibrary.org/b/id/${book.cover_i}-L.jpg`;
                    document.getElementById('coverPreview').src = uploadedCoverUrl;
                    document.getElementById('coverPreview').style.display = 'block';
                } else if (book.isbn && book.isbn[0]) {
                    uploadedCoverUrl = `https://covers.openlibrary.org/b/isbn/${book.isbn[0]}-L.jpg`;
                    document.getElementById('coverPreview').src = uploadedCoverUrl;
                    document.getElementById('coverPreview').style.display = 'block';
                }

                // Clear search results
                document.getElementById('searchResults').innerHTML = '<p style="color: #28a745; text-align: center;">‚úì Book selected! Please enter the price below.</p>';
                document.getElementById('bookSearchInput').value = '';
                
                // Focus on price field
                document.getElementById('bookPrice').focus();

            } catch (error) {
                console.error('Error loading book details:', error);
                alert('Error loading book details. Please try again.');
            }

            document.getElementById('loadingSpinner').style.display = 'none';
        }

        // Show add book form
        function showAddBookForm() {
            editingBookId = null;
            uploadedCoverUrl = null;
            document.getElementById('formTitle').textContent = 'Add New Book';
            document.getElementById('bookSearchInput').value = '';
            document.getElementById('searchResults').innerHTML = '';
            document.getElementById('bookTitle').value = '';
            document.getElementById('bookTitle').readOnly = true;
            document.getElementById('bookAuthor').value = '';
            document.getElementById('bookAuthor').readOnly = true;
            document.getElementById('bookCategory').value = 'Fiction';
            document.getElementById('bookSummary').value = '';
            document.getElementById('bookSummary').readOnly = true;
            document.getElementById('bookPrice').value = '';
            document.getElementById('bookISBN').value = '';
            document.getElementById('coverPreview').style.display = 'none';
            document.getElementById('loadingSpinner').style.display = 'none';
            document.getElementById('bookFormModal').style.display = 'block';
        }

        // Edit book
        function editBook(id) {
            const book = books.find(b => b.id === id);
            if (!book) return;

            editingBookId = id;
            uploadedCoverUrl = book.cover;
            document.getElementById('formTitle').textContent = 'Edit Book';
            document.getElementById('bookTitle').value = book.title;
            document.getElementById('bookTitle').readOnly = false;
            document.getElementById('bookAuthor').value = book.author;
            document.getElementById('bookAuthor').readOnly = false;
            document.getElementById('bookCategory').value = book.category;
            document.getElementById('bookSummary').value = book.summary;
            document.getElementById('bookSummary').readOnly = false;
            document.getElementById('bookPrice').value = book.price;
            document.getElementById('coverPreview').src = book.cover;
            document.getElementById('coverPreview').style.display = 'block';
            document.getElementById('bookFormModal').style.display = 'block';
        }

        // Save book
        async function saveBook() {
            const title = document.getElementById('bookTitle').value.trim();
            const author = document.getElementById('bookAuthor').value.trim();
            const category = document.getElementById('bookCategory').value;
            const summary = document.getElementById('bookSummary').value.trim();
            const price = document.getElementById('bookPrice').value;
            const isbn = document.getElementById('bookISBN').value.trim();

            if (!title || !author || !summary || !price) {
                alert('Please fill all required fields!');
                return;
            }

            let cover = uploadedCoverUrl || `https://covers.openlibrary.org/b/id/8739161-L.jpg`;
            
            if (isbn && !uploadedCoverUrl) {
                cover = `https://covers.openlibrary.org/b/isbn/${isbn}-L.jpg`;
            }

            if (editingBookId) {
                const index = books.findIndex(b => b.id === editingBookId);
                books[index] = { ...books[index], title, author, category, summary, price, cover };
            } else {
                books.push({
                    id: Date.now(),
                    title,
                    author,
                    category,
                    summary,
                    price,
                    cover
                });
            }

            saveBooks();
            displayBooks();
            displayAdminBooks();
            closeModal('bookFormModal');
        }

        // Delete book
        function deleteBook(id) {
            if (confirm('Are you sure you want to delete this book?')) {
                books = books.filter(b => b.id !== id);
                saveBooks();
                displayBooks();
                displayAdminBooks();
            }
        }

        // Export backup
        function exportBackup() {
            const dataStr = JSON.stringify(books, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bookiesplace_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            alert('Backup exported successfully!');
        }

        // Import backup
        function importBackup(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (confirm('This will replace all current books. Continue?')) {
                        books = imported;
                        saveBooks();
                        displayBooks();
                        displayAdminBooks();
                        alert('Backup imported successfully!');
                    }
                } catch (err) {
                    alert('Invalid backup file!');
                }
            };
            reader.readAsText(file);
        }

        // Auto backup reminder
        function setupAutoBackup() {
            const lastBackup = localStorage.getItem('bookiesplace_last_backup');
            const now = Date.now();
            const weekInMs = 7 * 24 * 60 * 60 * 1000;

            if (!lastBackup || (now - parseInt(lastBackup)) > weekInMs) {
                setTimeout(() => {
                    if (confirm('Weekly backup reminder! Would you like to export a backup now?')) {
                        exportBackup();
                        localStorage.setItem('bookiesplace_last_backup', now.toString());
                    }
                }, 5000);
            }
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
